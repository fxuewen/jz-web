<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>检务综合-首页</title>
    <link rel="stylesheet" href="./lib/layui-v2.5.5/css/layui.css" />
    <link rel="stylesheet" href="./css/defalut.css" />
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
      <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
      <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body class="layui-layout-body">
    <div class="layui-layout layui-layout-admin">
      <include src="./templates/side-bar.html"></include>
      <div class="layui-body">
        <include src="./templates/header.html"></include>
        <!-- 内容主体区域 -->
        <iframe width="100%" height="100%" frameborder="no" border="0" src="./components/index.html"></iframe>
      </div>
    </div>
    <script src="./lib/jquery.js"></script>
    <script src="./lib/include.js"></script>
    <script src="./lib/layui-v2.5.5/layui.js"></script>
    <script src="./js/default.js"></script>
    <script>
      $(window).load(function() {
        layui.use(['element', 'layer'], function() {
          var element = layui.element;
        });

        var ws = new WebSocket('ws://192.168.21.35:12345/websocket?userId=userId0');
        //readyState属性返回实例对象的当前状态，共有四种。
        //CONNECTING：值为0，表示正在连接。
        //OPEN：值为1，表示连接成功，可以通信了。
        //CLOSING：值为2，表示连接正在关闭。
        //CLOSED：值为3，表示连接已经关闭，或者打开连接失败
        //例如：if (ws.readyState == WebSocket.CONNECTING) { }

        //【用于指定连接成功后的回调函数】
        ws.onopen = function(evt) {
          console.log('Connection open ...');
          ws.send('Hello WebSockets!');
        };
        //ws.addEventListener('open', function (event) {
        //    ws.send('Hello Server!');
        //};

        //【用于指定收到服务器数据后的回调函数】
        //【服务器数据有可能是文本，也有可能是二进制数据，需要判断】
        ws.onmessage = function(event) {
          if (typeof event.data === String) {
            console.log('Received data string');
          }

          if (event.data instanceof ArrayBuffer) {
            var buffer = event.data;
            console.log('Received arraybuffer');
          }

          var data = JSON.parse(event.data);
          layer.open({
            type: 1,
            offset: 'rb', //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
            id: 'layerDemo' + 1, //防止重复弹出
            area: ['300px', '200px'],
            content: '<div style="padding: 20px">' + data.title + '</div>',
            shade: 0, //不显示遮罩
            yes: function() {
              layer.closeAll();
            }
          });
        };
      });
    </script>
  </body>
</html>
